<div
  class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50"
  (click)="onBackdropClick($event)"
>
  <div
    class="bg-white dark:bg-gray-800 rounded-lg shadow-lg w-full max-w-md p-6 relative"
    (click)="$event.stopPropagation()"
    (paste)="onPaste($event)"
    (drop)="onDrop($event)"
    (dragover)="onDragOver($event)"
  >
    <!-- HEADER -->
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-lg font-semibold text-gray-800 dark:text-gray-100">
        ğŸ“ Enviar archivo
      </h2>

      <!-- BotÃ³n de grabaciÃ³n -->
      <!-- <button
        type="button"
        class="px-3 py-1 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-sm"
        (click)="startRecording()"
        *ngIf="!isRecording && !recordedAudioUrl"
      >
        ğŸ™ï¸ Grabar audio
      </button> -->
    </div>

    <!-- =============================== -->
    <!-- PANEL DE GRABACIÃ“N DE AUDIO -->
    <!-- =============================== -->

    <!-- Mientras estÃ¡ grabando -->
    <div
      *ngIf="isRecording"
      class="mt-4 p-4 border border-red-300 bg-red-50 rounded-lg text-center"
    >
      <p class="text-red-700 font-medium">ğŸ¤ Grabandoâ€¦</p>
      <p class="text-xs text-gray-600">Habla ahora</p>

      <button
        class="mt-3 px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700"
        (click)="stopRecording()"
      >
        Detener grabaciÃ³n
      </button>
    </div>

    <!-- Vista previa del audio grabado -->
    <div
      *ngIf="recordedAudioUrl && !isRecording"
      class="mt-4 p-4 border border-blue-300 bg-blue-50 rounded-lg text-center"
    >
      <p class="text-gray-800 dark:text-gray-100 mb-2 font-medium">
        ğŸ§ Audio grabado
      </p>

      <audio controls [src]="recordedAudioUrl" class="w-full"></audio>

      <div class="mt-4 flex justify-end space-x-3">
        <button
          (click)="discardRecording()"
          class="px-3 py-2 bg-gray-300 dark:bg-gray-700 text-gray-700 dark:text-gray-200 rounded-md hover:bg-gray-400 dark:hover:bg-gray-600"
        >
          Descartar
        </button>

        <button
          (click)="sendRecordedAudio()"
          class="px-3 py-2 bg-green-600 text-white rounded-md hover:bg-green-700"
        >
          Enviar audio
        </button>
      </div>
    </div>

    <!-- =============================== -->
    <!-- PANEL DE ARCHIVOS â€” SOLO SI NO HAY AUDIO -->
    <!-- =============================== -->

    <div *ngIf="!isRecording && !recordedAudioUrl">
      <!-- Zona de selecciÃ³n -->
      <div
        class="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-5 text-center cursor-pointer"
        (click)="fileInput.click()"
      >
        <ng-container *ngIf="fileName; else placeholder">
          <div class="text-5xl mb-2">{{ filePreviewIcon }}</div>
          <p class="font-medium text-gray-800 dark:text-gray-200">
            {{ fileName }}
          </p>
          <p class="text-sm text-gray-500">Click para reemplazar</p>
        </ng-container>

        <ng-template #placeholder>
          <p class="text-gray-500">
            Arrastra, pega o haz click para seleccionar un archivo
          </p>
        </ng-template>

        <input
          type="file"
          #fileInput
          class="hidden"
          (change)="onFileChange($event)"
        />
      </div>

      <!-- Botones del archivo -->
      <div class="mt-5 flex justify-end space-x-3">
        <button
          (click)="onCancel()"
          class="px-4 py-2 text-sm bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600"
        >
          Cancelar
        </button>

        <button
          [disabled]="!fileName"
          (click)="onSend()"
          class="px-4 py-2 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed"
        >
          Enviar archivo
        </button>
      </div>
    </div>
  </div>
</div>